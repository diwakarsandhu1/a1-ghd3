<!DOCTYPE html>
<html lang="en">

  <head>
      <meta charset="UTF-8">
      <title>A1: Hello World! d3</title>
      <script src="https://d3js.org/d3.v7.min.js"></script>
      <style>
        body {
          background-color: black;
          display: flex;
          justify-content: center;
        }
      </style>
  </head>

  <body>
    <script>
      console.log(d3); // test if d3 is loaded

      const width = 800;
      const height = 500;

      // Create SVG Canvas
      const svg = d3.select("body")
                    .append("svg")
                    .attr("width", width)
                    .attr("height", height)
                    .style("background-color", "black");

      // Draw Pellets
      const pellets = [];

      function drawPellet(x, y, r, color) {
        const circle = svg.append("circle")
           .attr("cx", x)
           .attr("cy", y)
           .attr("r", r)
           .attr("fill", color);

        pellets.push({x: x, y: y, element: circle});
      }

      // Move Pellets
      function movePellets () {
          pellets.forEach(pellet => {
            pellet.x -= 2;
            pellet.element.attr("cx", pellet.x);
          });
      }

      // Remove Eaten Pellets
      function removeEatenPellets() {
          for (let i = pellets.length - 1; i >= 0; i--) {
            if (pellets[i].x < width * 0.37) {
              pellets[i].element.remove();
              pellets.splice(i, 1);
            }
          }
      }

      // Draw Pacman
      const pacman = svg.append("circle")
                        .attr("cx", width / 4)
                        .attr("cy", height / 2)
                        .attr("r", 80)
                        .attr("fill", "#FFFF00");
      
      const pacmanMouth = svg.append("path")
                        .attr("d", d3.arc()({
                          innerRadius: 0,
                          outerRadius: 80,
                          startAngle: Math.PI / 1.5,
                          endAngle: Math.PI / 3
                        }))
                        .attr("transform", `translate(${width * 0.26}, ${height / 2})`)
                        .attr("fill", "black");

      // Pellet Spawning/Moving/Removing Timer
      let lastSpawnTime = 0;
      const spawnInterval = 1000;

      const t = d3.timer(function(elapsed) {
        // Draw a pellet every 1 second
        if (elapsed - lastSpawnTime > spawnInterval) {
          drawPellet(width * 1.1 , height / 2, 10, "white");
          lastSpawnTime = elapsed;
        }
        movePellets();
        removeEatenPellets();
      });


      // Pacman Eating Animation
      let mouthOpen = true;
      d3.interval(() => {
        if (mouthOpen) {
          pacmanMouth.attr("d", d3.arc()({
            innerRadius: 0,
            outerRadius: 80,
            startAngle: Math.PI / 1.5,
            endAngle: Math.PI / 3
          }));
        } else {
          pacmanMouth.attr("d", d3.arc()({
            innerRadius: 0,
            outerRadius: 80,
            startAngle: Math.PI,
            endAngle: Math.PI
          }));
        }
        mouthOpen = !mouthOpen;
      }, 600);

      // Draw Borders
      svg.append("rect")
         .attr("x", 0)
         .attr("y", height * 0.25)
         .attr("width", width)
         .attr("height", 20)
         .attr("fill", "blue");

      svg.append("rect")
          .attr("x", 0)
          .attr("y", height * 0.75)
          .attr("width", width)
          .attr("height", 20)
          .attr("fill", "blue");
      
      
    </script>
  </body>
</html>
